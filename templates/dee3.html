<html>
  <head>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <link rel="stylesheet" href="static/main.css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">
    <title>DuoMoji</title>
  </head>
<body>
  <div id="node-canvas"></div>
  <div id="main-title">DuoMoji</div>
  <div id="main-desc">Track emoji combinations on twitter in realtime</div>
  <div id="rank-canvas"></div>
  <div id="bub-canvas"></div>
  <div id="bubsel-canvas"></div>
</body>



<script type="text/javascript">




var lWidth=7;
var nSize=37;

var nodeCanWidth=Math.round(d3.select('#node-canvas').style('width').slice(0, -2));
var cCenter=[nodeCanWidth/2,nodeCanWidth/2];
var cRadius=nodeCanWidth/2-50;

var nodeCanvas = d3.select("#node-canvas").append("svg")
                                      .attr("width", nodeCanWidth)
                                      .attr("height", nodeCanWidth)




var defs = nodeCanvas.append("defs");
var imgLen=(Array(100))
defs.selectAll(null)
    .data(imgLen)
    .enter()
    .append("pattern")
    .attr("id", function(d,i) {
        return "img-"+('00'+i).slice(-2)
    })
    .attr("height", "100%")
    .attr("width", "100%")
    .attr("patternContentUnits", "objectBoundingBox")
    .append("image")
    .attr('x',0.15)
    .attr('y',0.155)
    .attr("height", 0.7)
    .attr("width", 0.7)
    .attr("preserveAspectRatio", "none")
    .attr("xlink:href", function(d,i) {
        return "static/data/"+((i+1)+'.png')
    });




function drawPoint(canvas,center,r=10,_id="rand",fill='#FF8A65',_class='unclass'){
                    var circle = canvas.append("circle")
                                              //.attr("stroke", "#FF8A65")
                                              .attr("fill", fill)
                                              .attr('id',_id)
                                              .attr('class',_class)
                                              .attr("cx", center[0])
                                              .attr("cy", center[1])
                                              .attr("r" , r);
                    return circle;
}

function drawCurve(points,_id='rand',clr="#CFD8DC",anim=false){
                    var curveFunc = d3.line()
                        .x(function(d) {return d[0]})
                        .y(function(d) {return d[1]})
                        .curve(d3.curveBasis);
                    stWidth=lWidth;
                    if(anim)stWidth=10;
                    var curve = nodeCanvas.append("path")
                                            .attr('id',_id)
                                            .attr("d", curveFunc(points))
                                            .attr("stroke", clr)
                                            .attr("stroke-opacity", 0.2)
                                            .attr('stroke-linecap','round')
                                            .attr("stroke-width", stWidth)
                                            .attr("fill", "none");

                    if(anim){
                        var totalLength = curve.node().getTotalLength();
                        curve
                            .attr("stroke-dasharray", totalLength + " " + totalLength)
                            .attr("stroke-dashoffset", totalLength)
                            .transition()
                              .duration(1000)
                              .ease(d3.easeSin)
                              .attr("stroke-dashoffset", totalLength*3)
                    }
}


function plotNodes(center,radius,numNode){
                    var theta = 2*Math.PI/numNode;
                    var nodes=[]
                    for(var i=0;i<numNode;i++){
                        var x=center[0]+Math.sin(theta*i)*radius
                        var y=center[1]-Math.cos(theta*i)*radius
                        drawPoint(nodeCanvas,[x,y],r=nSize,_id='node-'+i,fill='url(#img-'+nodeList[i]+')')
                        nodes.push([x,y])
                    }
                    return nodes;

}

function findBend(center,numNode,ind1,ind2,sRadius){
                    var theta = 2*Math.PI/numNode;
                    var cx=center[0]+Math.sin(theta*ind1)*sRadius;
                    var cy=center[1]-Math.cos(theta*ind1)*sRadius;
                    var x=cx+Math.sin(theta*ind2)*sRadius
                    var y=cy-Math.cos(theta*ind2)*sRadius
                    return [x,y]
}


function drawLink(center,radius,nodes,ind1,ind2,clr="#CFD8DC",anim=false){
                  var bend=findBend(center,nodes.length,ind1,ind2,radius/4)
                  drawCurve([nodes[ind1],bend,nodes[ind2]],'link-'+ind1+'-'+ind2,clr,anim)
}



nodeList=['27', '86', '08', '01', '60', '31', '32',
           '14', '03', '24', '53', '11', '62', '05',
           '38', '48', '19', '28', '71', '10', '90',
           '00', '35', '12', '09']


nodeData=['0500', '0005', '1238', '0301', '0060', '0501',
'0001', '5327', '0532', '0024', '1900', '0524', '0528',
'1101', '2753', '0300', '4886', '0335', '0508', '0309',
'3135', '7127', '3562', '0308', '0103', '1005', '0019',
'0503', '0028', '0008', '6000', '0003', '6235', '9008',
'1400']





nodes=plotNodes(cCenter,cRadius,nodeList.length)
for(var i=0;i<nodeData.length;i++){
  a=nodeList.indexOf(nodeData[i].slice(0,2))
  b=nodeList.indexOf(nodeData[i].slice(2,4))
  drawLink(cCenter,cRadius,nodes,a,b,clr="#CFD8DC");
  d3.selectAll('circle').each(function(){this.parentNode.appendChild(this)})
}


</script>

<script>


archiveRank=[['0500', 2225], ['0005', 1722], ['1238', 1666], ['0301', 1028],
 ['0060', 967], ['0501', 841], ['0001', 832], ['5327', 821],
 ['0532', 814], ['0024', 802], ['1900', 662], ['0524', 656],
 ['0528', 606], ['1101', 534], ['2753', 524], ['0300', 501]]


rankOrder=['0500', '0005', '1238', '0301', '0060', '0501', '0001',
 '5327', '0532', '0024', '1900', '0524', '0528', '1101', '2753',
  '0300']





var rankCanWidth=Math.round(d3.select('#rank-canvas').style('width').slice(0, -2));
var rankCanheight=Math.round(d3.select('#rank-canvas').style('height').slice(0, -2));

var rankCanvas = d3.select("#rank-canvas").append("svg")
                                      .attr("width", rankCanWidth)
                                      .attr("height", rankCanheight)




var rh=(rankCanheight/8)-5;


function drawRank(rankList){

  rankCanvas.html("");

  console.log('drawing')
  rankList.sort(function(a,b){return b[1]-a[1]})
  for(var i=0;i<8;i++){
      rankCanvas.append("rect")
      .attr("rx", 23)
      .attr("ry", 23)
      .attr("x", 0)
      .attr("y", rh*i)
      .attr("width", 200)
      .attr("height", 46)
      .attr('id','rank-'+rankList[i][0])
      .style("fill", '#ECEFF1')

      rankCanvas.append("text")
      .attr("x", 105)
      .attr("y", (rh/2)+rh*i)
      .attr('font-family','Montserrat')
      .attr('font-size','22px')
      .attr('fill','#455A64')
      .attr('id','rval-'+rankList[i][0])
      .text(("000000"+rankList[i][1]).slice(-6));

      var a=rankList[i][0].slice(0,2)
      var b=rankList[i][0].slice(2,4)

      drawPoint(rankCanvas,[27,23+rh*i],r=25,_id='rnke-'+a,fill='url(#img-'+a+')')
      drawPoint(rankCanvas,[67,23+rh*i],r=25,_id='rnke-'+b,fill='url(#img-'+b+')')



  }

  for(var i=0;i<8;i++){
      rankCanvas.append("rect")
      .attr("rx", 23)
      .attr("ry", 23)
      .attr("x", 250)
      .attr("y", rh*i)
      .attr("width", 200)
      .attr("height", 46)
      .attr('id','rank-'+rankList[8+i][0])
      .style("fill", '#ECEFF1');

      var a=rankList[8+i][0].slice(0,2)
      var b=rankList[8+i][0].slice(2,4)


      drawPoint(rankCanvas,[277,23+rh*i],r=25,_id='rnke-'+a,fill='url(#img-'+a+')')
      drawPoint(rankCanvas,[317,23+rh*i],r=25,_id='rnke-'+b,fill='url(#img-'+b+')')


      rankCanvas.append("text")
      .attr("x", 355)
      .attr("y", (rh/2)+rh*i)
      .attr('font-family','Montserrat')
      .attr('font-size','22px')
      .attr('fill','#455A64')
      .attr('id','rval-'+rankList[i+8][0])
      .text(("000000"+rankList[i+8][1]).slice(-6));

  }

}


function blinkRank(comb){

  d3.select("#rank-"+comb).transition()
    .duration(200)
    .style("fill", "#FFAB91")
    .transition()
    .duration(500)
    .style("fill", "#ECEFF1")
}

function updateRank(comb){
  var j=rankOrder.indexOf(comb[0]);
  archiveRank[j][1]=comb[1];
  archiveRank.sort(function(a,b){return b[1]-a[1]});

  var rv = ("000000"+comb[1]).slice(-6)
  d3.select('#rval-'+comb[0]).text(rv)

  var orderChange=false;
  for(var i=0;i<archiveRank.length;i++){
    if(archiveRank[i][0]!=rankOrder[i])orderChange=true;
    rankOrder[i]=archiveRank[i][0]
  }
  if(orderChange)
    drawRank(archiveRank)

}

drawRank(archiveRank)

</script>




















<script>


setTimeout(function(){

  var source = new EventSource("{{ url_for('sse.stream') }}");
  source.addEventListener('nodelink', function(event) {
      var data = JSON.parse(event.data);
      var combData=data.message
      for(var i=0;i<combData.length;i++){

        if(rankOrder.indexOf(combData[i][0])>=0){
          blinkRank(combData[i][0])
          updateRank(combData[i])
        }


        a=nodeList.indexOf(combData[i][0].slice(0,2))
        b=nodeList.indexOf(combData[i][0].slice(2,4))
        drawLink(cCenter,cRadius,nodes,a,b,clr="#FF5722",anim=true);
        d3.selectAll('circle').each(function(){this.parentNode.appendChild(this)})
      }

  }, false);

  source.addEventListener('error', function(event) {
      console.log('connection failed')
  }, false);

},1000)


</script>




<script type="text/javascript">

var bubCanWidth=Math.round(d3.select('#bub-canvas').style('width').slice(0, -2));
var bubCanvas = d3.select("#bub-canvas").append("svg")
    .attr("width", bubCanWidth)
    .attr("height", bubCanWidth)
    //.style('background-color','#FFCCBC')




var bubData={'00': [0, 832, 0, 261, 204, 1722, 50, 27, 274, 99, 136, 11, 125, 23, 131, 36, 71, 179, 0, 295, 53, 54, 26, 49, 802, 69, 24, 137, 280, 37, 42, 16, 97, 118, 133, 98, 37, 30, 29, 22, 47, 80, 4, 4, 10, 56, 56, 9, 2, 20, 29, 0, 12, 77, 15, 4, 10, 18, 6, 51, 967, 131, 20, 13, 1, 40, 21, 53, 13, 0, 51, 30, 11, 36, 58, 44, 5, 0, 25, 5, 1, 7, 9, 20, 4, 4, 1, 23, 6, 8, 6, 20, 45, 0, 3, 4, 4, 1, 3, 1], '05': [2225, 841, 0, 289, 200, 0, 7, 12, 413, 21, 142, 5, 18, 49, 3, 0, 0, 65, 0, 19, 104, 4, 92, 1, 656, 0, 5, 149, 606, 11, 3, 23, 814, 15, 35, 61, 3, 3, 2, 2, 5, 2, 2, 23, 22, 101, 13, 2, 0, 74, 98, 0, 17, 187, 1, 0, 30, 1, 14, 2, 156, 8, 3, 2, 38, 11, 0, 1, 24, 0, 5, 102, 18, 82, 2, 5, 0, 0, 7, 11, 1, 5, 3, 6, 12, 0, 0, 0, 6, 1, 3, 2, 11, 0, 0, 0, 7, 5, 1, 0], '03': [501, 1028, 0, 0, 178, 152, 67, 1, 313, 405, 76, 23, 199, 3, 39, 19, 71, 119, 0, 29, 56, 13, 11, 9, 8, 147, 15, 162, 178, 40, 8, 185, 106, 41, 16, 463, 54, 2, 15, 0, 162, 23, 0, 0, 1, 44, 72, 0, 1, 40, 26, 2, 9, 98, 51, 0, 17, 25, 0, 11, 2, 11, 101, 11, 96, 38, 2, 2, 11, 0, 7, 35, 0, 63, 1, 6, 2, 15, 1, 1, 16, 13, 20, 3, 3, 1, 6, 17, 0, 14, 5, 3, 7, 0, 0, 1, 0, 0, 3, 1], '01': [99, 0, 8, 312, 6, 145, 100, 1, 70, 151, 30, 50, 19, 20, 20, 10, 10, 22, 0, 11, 83, 15, 14, 7, 13, 15, 81, 157, 75, 16, 6, 129, 13, 12, 34, 143, 15, 14, 1, 0, 14, 4, 2, 1, 11, 5, 8, 0, 0, 13, 4, 17, 3, 106, 75, 0, 37, 47, 0, 7, 1, 3, 6, 5, 33, 33, 2, 1, 3, 0, 5, 15, 0, 3, 6, 0, 1, 1, 2, 3, 9, 30, 8, 0, 2, 4, 6, 0, 0, 6, 27, 24, 3, 4, 0, 0, 2, 1, 1, 6], '12': [56, 81, 1, 41, 8, 3, 11, 1, 11, 8, 5, 2, 0, 2, 9, 5, 24, 60, 0, 5, 12, 7, 2, 4, 6, 14, 0, 16, 7, 8, 1, 8, 3, 0, 5, 32, 5, 2, 1666, 0, 6, 4, 0, 0, 11, 1, 20, 0, 2, 1, 2, 0, 0, 14, 14, 0, 4, 0, 0, 0, 0, 4, 0, 7, 0, 13, 3, 5, 0, 0, 0, 9, 3, 0, 2, 5, 3, 0, 1, 1, 0, 1, 5, 2, 0, 0, 3, 1, 0, 0, 7, 1, 2, 0, 0, 0, 0, 0, 2, 1], '06': [55, 142, 0, 220, 17, 2, 0, 1, 169, 93, 0, 26, 26, 6, 36, 20, 72, 123, 0, 13, 60, 9, 2, 0, 9, 16, 2, 55, 94, 17, 0, 34, 48, 15, 3, 5, 20, 8, 14, 1, 11, 2, 0, 0, 0, 85, 13, 0, 1, 18, 6, 1, 2, 21, 60, 1, 14, 15, 0, 2, 0, 3, 3, 10, 17, 8, 7, 7, 0, 0, 5, 16, 1, 16, 1, 3, 0, 0, 0, 0, 12, 0, 15, 0, 2, 0, 2, 0, 0, 10, 10, 18, 2, 1, 0, 2, 0, 0, 2, 2], '27': [13, 116, 0, 47, 10, 17, 10, 0, 22, 16, 2, 4, 8, 5, 5, 0, 1, 138, 0, 2, 77, 15, 2, 3, 6, 0, 10, 0, 163, 4, 2, 167, 11, 3, 6, 9, 7, 6, 1, 0, 2, 0, 0, 0, 1, 9, 4, 0, 0, 1, 0, 7, 0, 524, 13, 1, 35, 6, 0, 0, 0, 2, 3, 2, 3, 29, 1, 3, 2, 0, 2, 242, 1, 2, 2, 2, 0, 0, 0, 0, 1, 2, 2, 0, 1, 2, 1, 0, 0, 0, 7, 0, 1, 1, 0, 0, 0, 0, 10, 0], '31': [6, 107, 0, 211, 52, 5, 4, 0, 212, 9, 0, 4, 12, 2, 1, 1, 2, 1, 0, 1, 12, 8, 0, 2, 1, 6, 11, 39, 161, 1, 4, 0, 66, 2, 4, 398, 0, 1, 5, 0, 0, 7, 0, 1, 0, 41, 1, 0, 0, 13, 11, 0, 0, 66, 10, 0, 20, 13, 0, 1, 1, 0, 3, 0, 46, 2, 0, 0, 0, 0, 10, 18, 2, 18, 2, 1, 1, 0, 0, 0, 6, 2, 15, 4, 0, 0, 0, 0, 0, 1, 7, 0, 0, 0, 3, 0, 0, 0, 8, 0], '16': [156, 57, 0, 53, 16, 2, 88, 0, 16, 137, 0, 7, 36, 0, 62, 31, 0, 105, 0, 21, 7, 8, 0, 91, 0, 40, 3, 34, 11, 1, 0, 147, 12, 6, 2, 45, 19, 10, 13, 0, 34, 14, 0, 0, 0, 6, 5, 0, 3, 2, 2, 1, 2, 7, 9, 0, 2, 31, 3, 3, 0, 12, 33, 17, 2, 87, 4, 2, 0, 0, 8, 27, 0, 9, 1, 5, 0, 0, 0, 0, 1, 0, 20, 0, 0, 0, 1, 4, 0, 11, 2, 3, 24, 0, 0, 0, 0, 0, 1, 0], '53': [13, 96, 0, 18, 99, 11, 4, 0, 11, 9, 3, 4, 3, 3, 2, 0, 5, 4, 0, 1, 9, 1, 1, 0, 3, 8, 4, 821, 86, 0, 1, 108, 10, 2, 4, 10, 0, 9, 1, 0, 1, 1, 0, 0, 2, 3, 1, 0, 0, 9, 0, 0, 1, 0, 2, 0, 15, 0, 0, 0, 0, 0, 0, 0, 10, 1, 0, 6, 0, 0, 0, 129, 0, 3, 5, 0, 1, 0, 0, 0, 15, 1, 1, 0, 0, 0, 0, 0, 0, 2, 6, 0, 0, 0, 0, 0, 0, 0, 4, 2], '10': [187, 205, 0, 90, 26, 311, 6, 9, 67, 7, 0, 1, 25, 13, 0, 1, 0, 2, 0, 8, 7, 6, 15, 4, 63, 1, 1, 19, 36, 2, 1, 11, 25, 5, 14, 20, 3, 4, 0, 1, 11, 2, 10, 7, 8, 40, 3, 1, 0, 117, 8, 0, 0, 17, 1, 0, 0, 0, 8, 0, 8, 1, 3, 0, 0, 0, 0, 0, 10, 0, 1, 12, 7, 15, 2, 1, 0, 0, 3, 9, 0, 4, 1, 2, 9, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 5, 1, 0, 0], '35': [87, 79, 11, 97, 34, 25, 4, 2, 22, 35, 5, 4, 27, 1, 0, 11, 12, 10, 0, 3, 16, 4, 5, 26, 7, 151, 44, 6, 8, 14, 5, 47, 13, 13, 46, 0, 2, 1, 0, 0, 6, 10, 0, 0, 0, 2, 17, 0, 2, 19, 0, 0, 10, 11, 5, 0, 2, 22, 0, 0, 3, 2, 326, 2, 10, 32, 0, 0, 6, 0, 0, 24, 10, 1, 2, 12, 0, 3, 0, 1, 2, 4, 2, 0, 0, 1, 3, 11, 0, 11, 14, 0, 3, 2, 8, 1, 0, 0, 2, 10], '19': [662, 44, 0, 41, 2, 47, 6, 3, 3, 19, 3, 2, 30, 4, 30, 7, 16, 15, 0, 0, 9, 9, 7, 7, 19, 9, 3, 6, 26, 3, 3, 20, 11, 32, 1, 9, 12, 2, 9, 2, 9, 13, 2, 2, 3, 1, 3, 0, 0, 1, 1, 0, 1, 11, 2, 1, 5, 3, 0, 11, 5, 27, 11, 1, 0, 3, 1, 6, 0, 0, 7, 2, 0, 1, 0, 6, 0, 0, 0, 5, 0, 0, 5, 87, 7, 0, 0, 0, 1, 5, 0, 1, 1, 0, 0, 2, 0, 0, 0, 0], '20': [68, 137, 0, 27, 33, 57, 78, 1, 30, 35, 9, 10, 9, 43, 18, 0, 8, 32, 0, 15, 0, 6, 17, 0, 11, 14, 3, 77, 122, 73, 1, 14, 28, 0, 9, 8, 26, 4, 1, 1, 0, 5, 0, 5, 3, 14, 15, 1, 0, 2, 7, 12, 1, 19, 55, 1, 4, 0, 0, 1, 0, 1, 2, 4, 3, 8, 16, 1, 0, 0, 0, 14, 0, 12, 0, 7, 1, 0, 3, 8, 1, 1, 43, 1, 2, 0, 2, 0, 0, 2, 0, 1, 1, 0, 1, 0, 4, 0, 5, 1], '13': [59, 124, 0, 4, 18, 59, 2, 7, 77, 1, 10, 1, 21, 0, 0, 4, 2, 23, 0, 2, 48, 1, 39, 2, 192, 1, 1, 15, 55, 59, 2, 7, 48, 1, 5, 4, 20, 5, 0, 4, 1, 0, 5, 14, 10, 33, 9, 5, 0, 22, 12, 0, 3, 33, 1, 1, 2, 0, 4, 0, 1, 0, 0, 1, 0, 3, 0, 10, 5, 0, 0, 3, 3, 52, 1, 61, 0, 0, 12, 18, 1, 0, 1, 3, 10, 0, 11, 0, 0, 1, 0, 2, 2, 2, 0, 1, 2, 2, 0, 0], '09': [44, 186, 0, 189, 36, 1, 29, 1, 106, 0, 4, 6, 12, 0, 6, 1, 33, 24, 0, 8, 17, 4, 1, 1, 1, 16, 0, 31, 57, 5, 0, 22, 31, 2, 2, 26, 6, 13, 1, 0, 14, 17, 1, 1, 2, 21, 5, 2, 1, 27, 8, 0, 0, 30, 41, 0, 5, 40, 0, 1, 0, 2, 9, 1, 8, 4, 1, 13, 0, 0, 37, 7, 0, 13, 0, 1, 0, 0, 0, 0, 0, 4, 4, 0, 1, 0, 0, 1, 0, 18, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0], '25': [112, 25, 0, 36, 3, 4, 16, 1, 16, 20, 1, 1, 80, 0, 27, 17, 22, 113, 1, 13, 16, 6, 1, 0, 0, 0, 11, 10, 5, 6, 1, 18, 7, 5, 115, 241, 24, 0, 10, 0, 12, 22, 1, 0, 0, 2, 34, 1, 7, 3, 3, 1, 0, 6, 1, 0, 1, 2, 0, 4, 0, 4, 13, 10, 1, 38, 4, 2, 0, 1, 3, 1, 1, 5, 1, 21, 0, 0, 0, 0, 14, 0, 2, 2, 0, 0, 0, 3, 1, 2, 0, 3, 1, 2, 0, 0, 0, 0, 2, 0], '28': [16, 43, 0, 158, 4, 53, 17, 0, 27, 29, 4, 3, 8, 8, 4, 0, 9, 1, 0, 0, 20, 9, 2, 9, 1, 2, 16, 41, 0, 8, 2, 233, 5, 3, 0, 23, 6, 5, 0, 0, 1, 0, 0, 1, 2, 15, 7, 0, 0, 3, 2, 0, 0, 189, 12, 0, 88, 7, 0, 0, 1, 6, 5, 0, 5, 18, 0, 1, 0, 0, 0, 50, 0, 1, 4, 2, 0, 0, 2, 0, 2, 2, 7, 0, 0, 0, 0, 1, 0, 0, 6, 4, 0, 1, 0, 0, 1, 0, 3, 0], '14': [254, 82, 0, 42, 11, 2, 49, 0, 27, 31, 1, 11, 24, 1, 0, 13, 58, 117, 0, 31, 22, 5, 0, 4, 9, 14, 1, 16, 25, 12, 0, 9, 12, 6, 5, 4, 18, 0, 11, 1, 22, 11, 0, 0, 0, 4, 31, 0, 0, 6, 0, 0, 0, 5, 4, 0, 2, 7, 0, 3, 0, 19, 8, 17, 7, 7, 2, 5, 1, 0, 2, 2, 1, 2, 2, 8, 1, 0, 0, 0, 2, 2, 5, 4, 0, 1, 0, 2, 0, 1, 0, 8, 2, 0, 0, 0, 0, 1, 3, 0], '11': [30, 534, 0, 12, 15, 1, 20, 1, 55, 13, 0, 0, 3, 0, 5, 7, 6, 16, 0, 3, 22, 5, 0, 0, 10, 0, 2, 12, 67, 2, 2, 26, 11, 5, 2, 3, 3, 0, 2, 0, 3, 1, 0, 0, 0, 21, 1, 0, 3, 10, 4, 1, 0, 8, 8, 0, 13, 16, 0, 1, 1, 10, 3, 0, 2, 1, 1, 0, 0, 0, 1, 49, 1, 13, 2, 1, 0, 0, 0, 0, 7, 0, 8, 1, 0, 0, 0, 2, 0, 9, 0, 2, 0, 0, 1, 0, 0, 0, 2, 4], '23': [156, 41, 0, 62, 5, 6, 6, 3, 97, 3, 5, 7, 18, 6, 4, 50, 4, 3, 0, 11, 6, 16, 0, 0, 8, 7, 1, 9, 37, 4, 6, 88, 13, 8, 3, 112, 3, 4, 0, 6, 7, 2, 4, 1, 1, 5, 26, 0, 7, 7, 9, 0, 10, 4, 0, 0, 1, 5, 1, 8, 4, 3, 16, 1, 13, 9, 1, 1, 2, 0, 2, 9, 15, 7, 9, 0, 0, 1, 0, 1, 15, 0, 3, 11, 1, 0, 0, 3, 0, 1, 19, 2, 13, 0, 1, 6, 1, 2, 0, 1], '62': [81, 30, 0, 97, 8, 0, 7, 0, 19, 21, 0, 0, 3, 0, 3, 54, 22, 2, 0, 5, 0, 2, 0, 25, 3, 30, 2, 5, 10, 0, 0, 11, 10, 69, 4, 260, 1, 6, 0, 0, 50, 11, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 1, 0, 1, 14, 3, 5, 10, 1, 0, 0, 2, 0, 0, 0, 0, 0, 7, 0, 0, 1, 2, 11, 0, 2, 0, 0, 2, 2, 29, 3, 0, 2, 0, 3, 0, 4, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0], '08': [46, 38, 0, 77, 5, 36, 30, 0, 0, 52, 3, 9, 11, 5, 3, 0, 15, 9, 0, 3, 17, 4, 1, 1, 1, 2, 11, 15, 36, 3, 0, 134, 48, 5, 1, 11, 4, 4, 3, 0, 1, 4, 0, 2, 0, 14, 4, 0, 0, 18, 6, 0, 0, 20, 11, 0, 53, 18, 0, 2, 0, 5, 15, 0, 25, 9, 1, 1, 1, 0, 1, 4, 0, 11, 0, 0, 0, 0, 2, 0, 1, 7, 1, 1, 0, 0, 2, 1, 0, 3, 4, 8, 1, 0, 0, 0, 0, 0, 19, 1], '21': [64, 95, 0, 48, 21, 4, 9, 7, 91, 16, 2, 5, 15, 4, 9, 18, 8, 3, 0, 9, 17, 0, 0, 1, 5, 8, 4, 25, 20, 4, 4, 97, 29, 8, 5, 7, 2, 8, 6, 1, 2, 5, 0, 1, 4, 21, 2, 1, 1, 73, 4, 0, 0, 9, 3, 1, 7, 4, 0, 1, 1, 6, 6, 2, 3, 1, 0, 17, 2, 0, 0, 1, 0, 16, 0, 7, 1, 0, 1, 0, 5, 0, 7, 0, 0, 1, 0, 3, 0, 5, 3, 1, 1, 4, 0, 0, 0, 0, 0, 0], '17': [83, 23, 0, 29, 5, 8, 75, 0, 19, 49, 0, 17, 68, 9, 42, 2, 49, 0, 0, 8, 29, 3, 1, 3, 2, 32, 2, 10, 8, 3, 0, 10, 18, 1, 23, 13, 10, 1, 9, 0, 7, 24, 1, 2, 0, 2, 56, 3, 1, 0, 0, 0, 1, 0, 13, 0, 3, 1, 1, 0, 2, 6, 1, 12, 3, 26, 18, 0, 0, 0, 1, 5, 0, 2, 14, 15, 0, 0, 0, 0, 2, 1, 3, 1, 2, 3, 0, 2, 0, 0, 2, 3, 0, 0, 0, 0, 0, 2, 1, 0], '24': [92, 38, 0, 9, 7, 203, 5, 11, 2, 5, 14, 2, 9, 88, 2, 16, 0, 1, 0, 10, 11, 1, 107, 1, 0, 0, 1, 12, 1, 0, 0, 1, 7, 1, 3, 21, 2, 10, 1, 6, 0, 2, 7, 24, 44, 1, 0, 1, 4, 1, 4, 0, 0, 3, 3, 0, 1, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 27, 9, 0, 0, 0, 5, 2, 13, 2, 2, 0, 15, 9, 1, 0, 0, 1, 10, 0, 2, 0, 1, 0, 1, 0, 0, 0, 0, 1, 4, 1, 1, 0], '22': [50, 107, 0, 17, 21, 134, 2, 6, 36, 5, 12, 0, 0, 46, 0, 1, 0, 6, 0, 5, 13, 0, 0, 0, 231, 0, 0, 27, 22, 1, 0, 0, 7, 0, 0, 2, 0, 3, 0, 1, 2, 0, 4, 18, 9, 15, 2, 2, 0, 8, 12, 0, 1, 12, 3, 0, 0, 0, 11, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 3, 4, 1, 0, 0, 0, 5, 5, 0, 0, 1, 0, 10, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 1, 2, 3, 1, 0], '30': [99, 8, 0, 30, 1, 14, 2, 3, 10, 6, 5, 18, 1, 16, 5, 3, 1, 0, 0, 52, 2, 6, 2, 10, 5, 2, 1, 12, 3, 1, 0, 14, 3, 27, 4, 75, 5, 1, 0, 0, 1, 1, 1, 1, 0, 7, 0, 4, 0, 3, 6, 0, 7, 7, 0, 0, 2, 0, 1, 9, 198, 1, 1, 0, 0, 0, 2, 25, 0, 0, 5, 0, 1, 6, 0, 1, 1, 0, 0, 1, 0, 0, 0, 19, 2, 0, 0, 1, 2, 2, 0, 0, 5, 0, 0, 0, 1, 1, 2, 0], '15': [74, 16, 0, 18, 5, 6, 8, 9, 6, 18, 0, 4, 19, 12, 11, 0, 40, 6, 0, 15, 1, 12, 3, 2, 1, 15, 4, 4, 4, 1, 1, 5, 3, 9, 3, 191, 1, 12, 4, 2, 8, 11, 5, 2, 2, 7, 0, 1, 1, 1, 1, 0, 0, 4, 0, 4, 0, 10, 2, 3, 0, 5, 80, 1, 1, 1, 0, 1, 1, 0, 5, 4, 1, 2, 3, 1, 0, 0, 4, 0, 0, 1, 4, 3, 2, 0, 0, 3, 0, 2, 0, 0, 3, 0, 0, 0, 0, 2, 0, 0], '71': [3, 23, 0, 25, 7, 9, 7, 0, 8, 8, 1, 1, 2, 1, 2, 1, 1, 3, 0, 0, 12, 1, 1, 1, 1, 1, 0, 338, 29, 2, 0, 31, 2, 0, 1, 59, 1, 0, 0, 0, 1, 0, 0, 0, 0, 7, 5, 0, 2, 3, 0, 0, 0, 86, 5, 0, 11, 0, 0, 0, 1, 0, 0, 0, 2, 3, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 3, 0, 0, 0, 1, 3, 2, 8, 1, 0, 0, 0, 0, 0, 1], '65': [8, 26, 0, 40, 0, 2, 7, 0, 5, 3, 0, 0, 35, 0, 5, 1, 5, 14, 0, 5, 19, 1, 0, 3, 0, 24, 5, 35, 18, 7, 1, 15, 3, 0, 38, 179, 6, 0, 1, 1, 0, 2, 0, 0, 0, 3, 37, 0, 0, 0, 1, 0, 0, 18, 3, 0, 0, 0, 0, 0, 1, 2, 8, 9, 4, 0, 3, 0, 1, 0, 0, 19, 15, 4, 0, 19, 0, 0, 0, 1, 0, 2, 3, 3, 0, 0, 1, 0, 0, 2, 1, 1, 0, 0, 2, 0, 0, 1, 0, 1], '26': [9, 63, 0, 42, 10, 5, 6, 0, 24, 1, 1, 0, 3, 1, 3, 16, 6, 1, 0, 4, 6, 7, 0, 1, 107, 3, 0, 18, 14, 7, 1, 19, 3, 0, 2, 12, 2, 1, 0, 0, 9, 3, 2, 1, 3, 5, 2, 0, 0, 8, 1, 0, 0, 2, 1, 0, 0, 0, 1, 0, 0, 0, 6, 0, 3, 1, 0, 0, 1, 0, 13, 2, 0, 0, 0, 1, 0, 1, 0, 1, 0, 3, 1, 1, 0, 0, 0, 4, 0, 2, 2, 0, 0, 20, 0, 2, 0, 0, 0, 143]}


bubList=['00', '05', '03', '01', '12', '06', '27', '31', '16', '53', '10', '35', '19', '20', '13', '09', '25', '28', '14', '11', '23', '62', '08', '21', '17', '24', '22', '30', '15', '71', '65', '26']


function packer(raw){
  data=[{
      "name": "Root",
      "id": 0
  }];
  for(var i=0;i<raw.length;i++)
  data.push({'size':raw[i],'id':i+1,'parent':0})

  return data
}



var stratify = d3.stratify()
    .id(function(d) { return d.id; })
    .parentId(function(d) { return d.parent; });

var pack = d3.pack()
    .size([bubCanWidth, bubCanWidth]);



function getRoot(data) {
    return stratify(data)
        .sum(function(d) {
                return d.size;
        })
        .sort( function(a, b) {
        return 0;
    });
}



var selBub;


function updateData(emId) {
  selBub=emId
  raw=bubData[emId]
  data=packer(raw)
  render(getRoot(data));
};

function render(root) {
    var packedNodes = pack(root);
    var children = packedNodes.leaves();


    var circles = bubCanvas.selectAll("circle")
        .data(children, function(d) {
            return d.id;
        });

    var entering = circles.enter()
            .append("circle");



    circles.merge(entering)
                .transition().duration(500)
                .attr("cx", function(d) {
                    return d.x
                })
                .attr("cy", function(d) {
                    return d.y
                })
                .attr('fill',function(d,i){
                  return 'url(#img-'+('00'+i).slice(-2)+')'
                })
                .attr('r',function(d){return d.r})
                .attr('stroke','#CFD8DC')

}

updateData('00')

</script>
<script>

var bubselCanWidth=Math.round(d3.select('#bubsel-canvas').style('width').slice(0, -2));
var bubselCanHeight=Math.round(d3.select('#bubsel-canvas').style('height').slice(0, -2));
var bubselCanvas = d3.select("#bubsel-canvas").append("svg")
    .attr("width", bubselCanWidth)
    .attr("height", bubselCanHeight)




for(var i=0;i<32;i++){
  drawPoint(bubselCanvas,[32+65*(i%8),32+70*parseInt(i/8)],r=31,
  _id='bubselbg-'+bubList[i],fill='None',_class='bubselbg')

  drawPoint(bubselCanvas,[32+65*(i%8),32+70*parseInt(i/8)],r=30,
  _id='bubsel-'+bubList[i],fill='url(#img-'+bubList[i]+')',_class='bubsel-btn')
}

d3.select('#bubselbg-'+bubList[0]).attr('fill','#E6EE9C')

d3.selectAll(".bubsel-btn")
    .on("click",function(){
       _ind=d3.select(this).attr('id').slice(-2);
       d3.selectAll(".bubselbg").attr('fill','none');
       d3.select('#bubselbg-'+_ind).attr('fill','#E6EE9C')
       updateData(_ind);
    });


    d3.selectAll(".bubsel-btn")
        .on("mouseover", function(){
            _ind=d3.select(this).attr('id').slice(-2)
            d3.select('#bubselbg-'+_ind).transition().duration(500).attr('fill','#E6EE9C')

        })
        .on("mouseout", function(){
          _ind=d3.select(this).attr('id').slice(-2)
          if(_ind==selBub)return;
          d3.select('#bubselbg-'+_ind).transition().duration(500).attr('fill','none')
        });

</script>


</html>
